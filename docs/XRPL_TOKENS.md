# XRPL Yield-Bearing Tokens: RLUSD, mUSD, and RLUSD+

## Overview

This project implements a yield-bearing token system on the XRP Ledger (XRPL) Testnet. The system creates a token chain that enables yield generation through a series of fungible tokens:

```
XRP → RLUSD → mUSD → RLUSD+
```

## Token Chain Architecture

### 1. RLUSD (Currency Code: RLD)
- **Type**: Stablecoin
- **Purpose**: Entry point to the yield-bearing system
- **Peg**: Conceptually pegged to USD
- **Transfer Fee**: 0%
- **How to Get**: Convert XRP to RLUSD through the hot wallet or XRPL DEX

### 2. mUSD (Currency Code: MUD)
- **Type**: Medium Token
- **Purpose**: Intermediate token for conversion between RLUSD and RLUSD+
- **Transfer Fee**: 0%
- **How to Get**: Convert RLUSD to mUSD through trust lines

### 3. RLUSD+ (Currency Code: RLP)
- **Type**: Yield-Bearing Token
- **Purpose**: Generates yield through transfer fees
- **Transfer Fee**: 1%
- **Yield Mechanism**: Every transfer of RLUSD+ incurs a 1% fee, which accrues to the issuer and is redistributed as yield
- **How to Get**: Convert mUSD to RLUSD+ through trust lines

## Wallet Architecture

Each token has two wallets:

### Cold Wallet (Issuer)
- **Purpose**: Issues and manages the token supply
- **Settings**:
  - DefaultRipple: Enabled (allows tokens to transfer between users)
  - RequireAuth: Disabled (for easy adoption)
  - DisallowXRP: Enabled (prevents accidental XRP payments)
  - RequireDestTag: Enabled (for proper accounting)
- **Security**: Should be kept offline in production

### Hot Wallet (Distributor)
- **Purpose**: Distributes tokens to users
- **Settings**:
  - DefaultRipple: Disabled (prevents unintended rippling)
  - RequireAuth: Enabled (prevents accidental trust lines)
  - DisallowXRP: Enabled
  - RequireDestTag: Enabled
- **Usage**: Active wallet for day-to-day operations

## Installation

### 1. Install Dependencies

```bash
pip install -r requirements.txt
```

This will install `xrpl-py>=2.5.0` and all other required dependencies.

### 2. Verify Installation

```python
from solana_swarm.integrations.xrpl import XRPLClient, TokenIssuer
print("XRPL integration installed successfully!")
```

## Usage

### Issuing Tokens

#### Basic Usage

```bash
# Issue tokens with default supply (1,000,000 each)
python scripts/issue_xrpl_tokens.py --save-config
```

#### Custom Supply

```bash
# Issue tokens with custom supply
python scripts/issue_xrpl_tokens.py --supply 5000000 --save-config
```

#### Load Existing Configuration

```bash
# Load previously created wallets
python scripts/issue_xrpl_tokens.py --load-config xrpl_wallets.json
```

### Programmatic Usage

```python
from decimal import Decimal
from solana_swarm.integrations.xrpl.client import XRPLClient
from solana_swarm.integrations.xrpl.token_issuer import TokenIssuer

# Initialize client (testnet)
client = XRPLClient(network_url="https://s.altnet.rippletest.net:51234")

# Create token issuer
issuer = TokenIssuer(client)

# Create the complete token chain
tokens = issuer.create_yield_bearing_chain(
    rlusd_supply=Decimal("1000000"),
    musd_supply=Decimal("1000000"),
    rlusd_plus_supply=Decimal("1000000")
)

# Save wallet configuration
issuer.save_wallet_config("my_wallets.json")

# Print summary
issuer.print_summary()

# Get balances
balances = issuer.get_all_balances()
print(balances)
```

## User Guide: How to Use the Tokens

### Step 1: Create Trust Lines

Before you can receive any of these tokens, you need to create trust lines to them:

```python
from xrpl.wallet import Wallet
from xrpl.models.transactions import TrustSet
from xrpl.models.amounts import IssuedCurrencyAmount
from decimal import Decimal

# Your wallet
my_wallet = Wallet.from_seed("your_seed_here")

# Create trust line to RLUSD
rlusd_trust = TrustSet(
    account=my_wallet.classic_address,
    limit_amount=IssuedCurrencyAmount(
        currency="RLD",
        issuer="rN7n7otQDd6FczFgLdlqtyMVrn3HMgCYK9",  # RLUSD cold wallet
        value="1000000"
    )
)

# Submit transaction (similar process for MUD and RLP)
```

### Step 2: Acquire Tokens

You can acquire tokens through:

1. **Direct Transfer**: Request tokens from the hot wallet
2. **DEX Trading**: Trade XRP or other tokens for RLUSD, mUSD, or RLUSD+
3. **Token Swap**: Convert between tokens in the chain

### Step 3: Move Through the Token Chain

```
XRP → RLUSD → mUSD → RLUSD+
```

To get to RLUSD+ (the yield-bearing token):
1. Convert XRP to RLUSD
2. Convert RLUSD to mUSD
3. Convert mUSD to RLUSD+

### Step 4: Earn Yield

Once you hold RLUSD+:
- Every transfer of RLUSD+ incurs a 1% fee
- This fee accumulates in the ecosystem
- Holders benefit from the yield generated by the transfer fee mechanism

## Token Information

### RLUSD (RLD)

| Property | Value |
|----------|-------|
| Currency Code | RLD |
| Initial Supply | 1,000,000 |
| Transfer Fee | 0% |
| Cold Wallet | (Generated on creation) |
| Hot Wallet | (Generated on creation) |

### mUSD (MUD)

| Property | Value |
|----------|-------|
| Currency Code | MUD |
| Initial Supply | 1,000,000 |
| Transfer Fee | 0% |
| Cold Wallet | (Generated on creation) |
| Hot Wallet | (Generated on creation) |

### RLUSD+ (RLP)

| Property | Value |
|----------|-------|
| Currency Code | RLP |
| Initial Supply | 1,000,000 |
| Transfer Fee | 1% |
| Cold Wallet | (Generated on creation) |
| Hot Wallet | (Generated on creation) |

## API Reference

### XRPLClient

Main client for interacting with XRPL.

```python
client = XRPLClient(network_url="https://s.altnet.rippletest.net:51234")
```

**Methods:**
- `create_wallet()`: Generate new testnet wallet
- `get_wallet_from_seed(seed)`: Load wallet from seed
- `configure_account(wallet, **settings)`: Configure account settings
- `create_trust_line(config, wallet)`: Create trust line
- `send_token(from_wallet, to_address, amount, currency, issuer)`: Send tokens
- `get_account_lines(address)`: Get trust lines for account
- `get_gateway_balances(issuer_address)`: Get issuer balances
- `get_xrp_balance(address)`: Get XRP balance

### TokenIssuer

Handles token issuance and management.

```python
issuer = TokenIssuer(client)
```

**Methods:**
- `create_token_pair(token_name, currency_code, initial_supply, **options)`: Create single token
- `create_yield_bearing_chain(rlusd_supply, musd_supply, rlusd_plus_supply)`: Create complete chain
- `save_wallet_config(filepath)`: Save wallet configuration
- `load_wallet_config(filepath)`: Load wallet configuration
- `get_all_balances()`: Get balances for all tokens
- `print_summary()`: Print token summary

## Configuration File Format

The wallet configuration is saved in JSON format:

```json
{
  "RLUSD": {
    "cold_address": "rN7n7otQDd6FczFgLdlqtyMVrn3HMgCYK9",
    "cold_seed": "sEdTM1uX8pu2do5XvTnutH6HsouMaM2",
    "hot_address": "rLHzPsX6oXkzU9S7J7TTgfuaBUVLxKb2Ta",
    "hot_seed": "sEdV19BLfeQeKdEXyYA4NhjPJe6XBd1"
  },
  "mUSD": {
    ...
  },
  "RLUSD+": {
    ...
  }
}
```

## Security Considerations

### Production Deployment

1. **Cold Wallets**:
   - Keep cold wallet seeds offline and secure
   - Use hardware wallets or secure key management systems
   - Never expose cold wallet seeds in code or logs

2. **Hot Wallets**:
   - Monitor hot wallet balances regularly
   - Implement rate limiting for distributions
   - Set up alerts for unusual activity

3. **Network**:
   - For production, use Mainnet: `https://xrplcluster.com`
   - Ensure secure HTTPS connections
   - Validate all transaction results

### Testnet vs Mainnet

**Current Setup**: Testnet (default)
- Network: `https://s.altnet.rippletest.net:51234`
- Free testnet XRP from faucet
- Safe for testing and development
- State may be reset periodically

**Production Setup**: Mainnet
- Network: `https://xrplcluster.com`
- Real XRP required
- Permanent state
- Requires careful security measures

## Troubleshooting

### Issue: "xrpl-py not installed"

**Solution**:
```bash
pip install xrpl-py>=2.5.0
```

### Issue: "Transaction failed with tecNO_LINE_INSUF_RESERVE"

**Solution**: The account doesn't have enough XRP to meet the reserve requirement. Each trust line requires additional reserve. Get more testnet XRP from the faucet or fund the account.

### Issue: "Transaction failed with tecNO_DST_INSUF_XRP"

**Solution**: The destination account doesn't have the minimum XRP balance. Fund the account with at least 10 XRP from the testnet faucet.

### Issue: "Cannot create trust line"

**Solution**: Ensure:
1. The issuer account has DefaultRipple enabled
2. You have enough XRP for the reserve
3. The currency code is exactly 3 characters
4. The issuer address is correct

## Examples

### Example 1: Issue Tokens and Save Configuration

```python
from solana_swarm.integrations.xrpl import XRPLClient, TokenIssuer
from decimal import Decimal

# Create client and issuer
client = XRPLClient()
issuer = TokenIssuer(client)

# Issue tokens
tokens = issuer.create_yield_bearing_chain(
    rlusd_supply=Decimal("10000000"),
    musd_supply=Decimal("10000000"),
    rlusd_plus_supply=Decimal("5000000")
)

# Save configuration
issuer.save_wallet_config("production_wallets.json")

# Print summary
issuer.print_summary()
```

### Example 2: Load Configuration and Check Balances

```python
from solana_swarm.integrations.xrpl import XRPLClient, TokenIssuer

# Create client and issuer
client = XRPLClient()
issuer = TokenIssuer(client)

# Load existing configuration
issuer.load_wallet_config("production_wallets.json")

# Get all balances
balances = issuer.get_all_balances()

# Print balances
for token_name, info in balances.items():
    print(f"\n{token_name}:")
    print(f"  Hot Wallet XRP: {info['hot_wallet']['xrp_balance']} XRP")
    print(f"  Cold Wallet XRP: {info['cold_wallet']['xrp_balance']} XRP")
```

### Example 3: Send Tokens to User

```python
from solana_swarm.integrations.xrpl import XRPLClient
from decimal import Decimal

# Create client
client = XRPLClient()

# Load hot wallet
hot_wallet = client.get_wallet_from_seed("sEdV19BLfeQeKdEXyYA4NhjPJe6XBd1")

# Send RLUSD to user
result = client.send_token(
    from_wallet=hot_wallet,
    to_address="rUserAddressHere",
    amount=Decimal("100"),
    currency="RLD",
    issuer="rN7n7otQDd6FczFgLdlqtyMVrn3HMgCYK9",
    destination_tag=1
)

print(f"Transaction hash: {result['hash']}")
```

## Additional Resources

- [XRPL Documentation](https://xrpl.org/)
- [xrpl-py Library](https://github.com/XRPLF/xrpl-py)
- [XRPL Testnet Explorer](https://testnet.xrpl.org/)
- [XRPL Testnet Faucet](https://xrpl.org/xrp-testnet-faucet.html)

## Support

For issues or questions:
1. Check the troubleshooting section above
2. Review XRPL documentation
3. Open an issue in the project repository

## License

This integration is part of the IGNYTE Solana AI Studio project.
